
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>ENGS149 Homework 6</title><meta name="generator" content="MATLAB 9.3"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2018-02-23"><meta name="DC.source" content="HW6_1.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>ENGS149 Homework 6</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Problem 1</a></li><li><a href="#2">Part 2</a></li><li><a href="#5">Part 3</a></li><li><a href="#10">Part 4</a></li><li><a href="#13">Part 5</a></li><li><a href="#14">Part 6</a></li><li><a href="#15">Part 7</a></li></ul></div><h2 id="1">Problem 1</h2><p>Setup discrete system</p><pre class="codeinput">close <span class="string">ALL</span> <span class="string">HIDDEN</span>
n = 2;
ll = 50;
A_c = [0 1; -1 0];
B_c = [0;1];
C = [1 0];
D = 0;
dt=0.2;
[r,n] = size(C);
[r,m] = size(D);
mat_ss = ss(A_c,B_c,C,D);
sys_dsct = c2d(mat_ss,dt);
A_d = sys_dsct.A;
B_d = sys_dsct.B;
C_d = sys_dsct.C;
D_d = sys_dsct.D;
</pre><h2 id="2">Part 2</h2><pre class="codeinput">inp = randn(1,ll);
x_0 = [1 0];

[Y,X] = dlsim(A_d,B_d,C_d,D_d,inp,x_0);
</pre><p>Using the acker function, we place the eigenvalues of A+GC at 0</p><pre class="codeinput">G = acker(A_d',-C_d',[0 0])';
</pre><p>Here, I check G is working as expected by taking the norm of (A+GC)^2</p><pre class="codeinput">norm((A_d+G*C)^2)
</pre><pre class="codeoutput">
ans =

   1.8310e-15

</pre><h2 id="5">Part 3</h2><p>Generate Markov Parameters, System and Observer</p><pre class="codeinput">n = 2;
N = 4;
OMP = zeros(1,2*n+1);
</pre><p>From class, we define the observer Markov Parameters using the following equations.</p><p><img src="HW6_1_eq17287890398568106080.png" alt="$\bar{Y}_0 = D$"></p><p><img src="HW6_1_eq18348782595169654827.png" alt="$$\bar{Y}_i = C\bar{A}^{i-1}\bar{B}, i = 1...\infty$$"></p><p>Where</p><p><img src="HW6_1_eq04161431631736075788.png" alt="$$\bar{A} = A+GC$$"></p><p><img src="HW6_1_eq08450136847625200612.png" alt="$$\bar{B} = [B+GD, -G]$$"></p><pre class="codeinput">OMP(1) = D;
<span class="keyword">for</span> i=1:n

    OMP(2*i:2*i+1) = C_d*(A_d+G*C_d)^(i-1)*[B_d+G*D_d -G];
<span class="keyword">end</span>
</pre><p>We compare this to the observer markov parameters calculated via the solution to the observer equation:</p><p><img src="HW6_1_eq13303029075725665859.png" alt="$\bar{y}=\bar{P}\bar{V}$"></p><p>or equivalently,</p><p><img src="HW6_1_eq01079639065456260035.png" alt="$$\bar{P}=\bar{y}\bar{V}^{\dagger}$$"></p><pre class="codeinput">[Y_bar, V_bar] = YV_Form_nonzero(inp,Y',n);
</pre><p>The pinv2 function (attached) calculates the pseudoinverse using the SVD with a tolerance on the percentage of each individual singular value to the largest singular value</p><pre class="codeinput">cap_y_hat = Y_bar'*pinv2(V_bar,1e-5);
</pre><p>The Normalized Singular Values of <img src="HW6_1_eq08983817306374948820.png" alt="$\bar{V}$"> for p=2</p><pre class="codeinput">figure
s_v_d  = svd(V_bar)';
s_v_d = s_v_d/max(s_v_d);
plot(s_v_d,<span class="string">'-x'</span>)


title(<span class="string">'Normalized Singular Values of V_{bar}'</span>)
ylabel(<span class="string">'$\frac{\sigma_i}{\sigma_r}$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,30)
set(get(gca, <span class="string">'YLabel'</span>), <span class="string">'Rotation'</span>, 0,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>)
xlabel(<span class="string">'$i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
axis([1 inf 0 inf])
xticks(1:1:length(s_v_d))
figure
plot(abs(OMP-cap_y_hat))
title(<span class="string">'Recovered Observer Markov Parameter Error'</span>)
ylabel(<span class="string">'$\bar{Y}_i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
xlabel(<span class="string">'$i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
set(get(gca, <span class="string">'YLabel'</span>), <span class="string">'Rotation'</span>, 0,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>)
axis([1 inf 0 inf])
xticks(1:1:length(OMP))
</pre><img vspace="5" hspace="5" src="HW6_1_01.png" alt=""> <img vspace="5" hspace="5" src="HW6_1_02.png" alt=""> <h2 id="10">Part 4</h2><p>Generate System Markov Parameters</p><pre class="codeinput">n_mp = 5;
</pre><p>The system Markov Parameters are generated through the following equation:</p><p><img src="HW6_1_eq00628708609349378400.png" alt="$$Y_0 = D$$"></p><p><img src="HW6_1_eq09191438529524770945.png" alt="$$Y_i = CA^{i-1}B, i = 1\dots\infty$$"></p><p>The first five Markov Parameters are</p><pre class="codeinput">SMP = zeros(1,n+1);
SMP(1) = D;
<span class="keyword">for</span> i=1:n_mp-1
    SMP(i+1) = C_d*A_d^(i-1)*B_d;
<span class="keyword">end</span>
SMP
</pre><pre class="codeoutput">
SMP =

         0    0.0199    0.0590    0.0957    0.1286

</pre><p>We can recover the System Markov Parameters using the function recover_SYSMP.</p><p>The function uses the following formula:</p><p><img src="HW6_1_eq09660125364858543185.png" alt="$$Y_k = \bar{Y}^{(1)}_k - \sum_{i=1}^{k}\bar{Y}_i^{(2)}Y_{k-i}\quad k=1\dots p$$"></p><p><img src="HW6_1_eq01626669757547368776.png" alt="$$Y_k = - \sum_{i=1}^{k}\bar{Y}_i^{(2)}Y_{k-i}\quad k=p+1\dots \infty$$"></p><pre class="codeinput">RSMP = recover_SYSMP(cap_y_hat,n_mp,r,m);
SMP;

figure

plot(abs(SMP-RSMP));


axis([1 inf 0 inf])
xticks(1:1:length(SMP))
title(<span class="string">'Recovered System Markov Parameter Error'</span>)
ylabel(<span class="string">'$Y_i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
xlabel(<span class="string">'$i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
set(get(gca, <span class="string">'YLabel'</span>), <span class="string">'Rotation'</span>, 0,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>)
</pre><img vspace="5" hspace="5" src="HW6_1_03.png" alt=""> <h2 id="13">Part 5</h2><p>We repeat parts 3 and 4 above with p=6</p><pre class="codeinput">n = 6;
N = 4;
OMP = zeros(1,2*n+1);

OMP(1) = D;
<span class="keyword">for</span> i=1:n

    OMP(2*i:2*i+1) = C_d*(A_d+G*C_d)^(i-1)*[B_d+G*D_d -G];
<span class="keyword">end</span>


[Y_bar, V_bar] = YV_Form_nonzero(inp,Y',n);
cap_y_hat = Y_bar'*pinv2(V_bar,1e-5);



figure
s_v_d  = svd(V_bar)';
s_v_d = s_v_d/max(s_v_d);
plot(s_v_d,<span class="string">'-x'</span>)
title(<span class="string">'Normalized Singular Values of V_{bar}'</span>)
ylabel(<span class="string">'$\frac{\sigma_i}{\sigma_r}$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,30)
set(get(gca, <span class="string">'YLabel'</span>), <span class="string">'Rotation'</span>, 0,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>)
xlabel(<span class="string">'$i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
axis([1 inf 0 inf])
xticks(1:1:length(s_v_d))



<span class="comment">% Generate System Markov Parameters</span>

n_mp = 50;

SMP = zeros(1,n+1);
SMP(1) = D;
<span class="keyword">for</span> i=1:n_mp-1
    SMP(i+1) = C_d*A_d^(i-1)*B_d;
<span class="keyword">end</span>
RSMP = recover_SYSMP(cap_y_hat,n_mp,r,m);
SMP;

figure

plot(abs(SMP-RSMP));
title(<span class="string">'Recovered System Markov Parameter Error'</span>)
ylabel(<span class="string">'$Y_i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
xlabel(<span class="string">'$i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
set(get(gca, <span class="string">'YLabel'</span>), <span class="string">'Rotation'</span>, 0,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>)
axis([1 inf 0 inf])
xticks(1:5:length(SMP))
</pre><img vspace="5" hspace="5" src="HW6_1_04.png" alt=""> <img vspace="5" hspace="5" src="HW6_1_05.png" alt=""> <h2 id="14">Part 6</h2><p>Repeat 3 and 4, but measure velocity and position</p><pre class="codeinput">n = 1;
n_mp = 50;
ll = 50;
A_c = [0 1; -1 0];
B_c = [0;1];
C = [0 1;1 0];
D = [0;0];
dt=0.2;
[r_outputs,n_states] = size(C);
[r_outputs,m_inputs] = size(D);
mat_ss = ss(A_c,B_c,C,D);
sys_dsct = c2d(mat_ss,dt);
A_d = sys_dsct.A;
B_d = sys_dsct.B;
C_d = sys_dsct.C;
D_d = sys_dsct.D;

G2 = place(A_d',-C_d',[0 0]);

inp = randn(1,ll);
x_0 = [1 0.5];
[Y, X] = dlsim(A_d,B_d,C_d,D_d,inp,x_0);


[Y_bar, V_bar] = YV_Form_nonzero(inp,Y',n);


cap_y_hat = Y_bar'*pinv2(V_bar,1e-8);
figure
s_v_d  = svd(V_bar)';
s_v_d = s_v_d/max(s_v_d);
plot(s_v_d,<span class="string">'-x'</span>)
title(<span class="string">'Normalized Singular Values of V_{bar}'</span>)
ylabel(<span class="string">'$\frac{\sigma_i}{\sigma_r}$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,30)
set(get(gca, <span class="string">'YLabel'</span>), <span class="string">'Rotation'</span>, 0,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>)
xlabel(<span class="string">'$i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
axis([1 inf 0 inf])
xticks(1:1:length(s_v_d))



RSMP = recover_SYSMP(cap_y_hat,n_mp,r_outputs,m_inputs);
SMP6 = zeros(2,n_mp);
SMP6(:,1) = D_d;
<span class="keyword">for</span> i=1:n_mp-1
    SMP6(:,i+1) = C_d*(A_d)^(i-1)*B_d;
<span class="keyword">end</span>


OMP6 = zeros(2,3*n+1);
OMP6(:,1) = D_d;

<span class="keyword">for</span> i=1:n

    OMP6(:,3*i-1:3*i+1) = C_d*(A_d+G2*C_d)^(i-1)*[B_d+G2*D_d -G2];
<span class="keyword">end</span>

figure
plot(vecnorm(OMP6-cap_y_hat));
title(<span class="string">'Recovered Observer Markov Parameter Error'</span>)
ylabel(<span class="string">'$\bar{Y}_i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
xlabel(<span class="string">'$i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
set(get(gca, <span class="string">'YLabel'</span>), <span class="string">'Rotation'</span>, 0,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>)
axis([1 inf 0 inf])
xticks(1:1:length(OMP6))

figure
plot(vecnorm(abs(SMP6-RSMP)));
title(<span class="string">'Recovered System Markov Parameter Error'</span>)
ylabel(<span class="string">'$Y_i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
xlabel(<span class="string">'$i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
set(get(gca, <span class="string">'YLabel'</span>), <span class="string">'Rotation'</span>, 0,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>)
axis([1 inf 0 inf])
xticks(1:5:length(SMP))
</pre><img vspace="5" hspace="5" src="HW6_1_06.png" alt=""> <img vspace="5" hspace="5" src="HW6_1_07.png" alt=""> <img vspace="5" hspace="5" src="HW6_1_08.png" alt=""> <h2 id="15">Part 7</h2><p>Repeat for p=4</p><pre class="codeinput">n = 6;
ll = 50;
A_c = [0 1; -1 0];
B_c = [0;1];
C = [1 0;0 1];
D = [0;0];
dt=0.2;
[r,n] = size(C);
[r,m] = size(D);

mat_ss = ss(A_c,B_c,C,D);
sys_dsct = c2d(mat_ss,dt);
A_d = sys_dsct.A;
B_d = sys_dsct.B;
C_d = sys_dsct.C;
D_d = sys_dsct.D;

G2 = place(A_d',-C_d',[0 0]);

inp = randn(1,ll);
x_0 = [1 0];
[Y, X] = dlsim(A_d,B_d,C_d,D_d,inp,x_0);


[Y_bar, V_bar] = YV_Form_nonzero(inp,Y',n);

LM = 15;
cap_y_hat = Y_bar'*pinv2(V_bar,1e-5);
figure
s_v_d  = svd(V_bar)';
s_v_d = s_v_d/max(s_v_d);
plot(s_v_d,<span class="string">'-x'</span>)
title(<span class="string">'Normalized Singular Values of V_{bar}'</span>)
ylabel(<span class="string">'$\frac{\sigma_i}{\sigma_r}$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,30)
set(get(gca, <span class="string">'YLabel'</span>), <span class="string">'Rotation'</span>, 0,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>)
xlabel(<span class="string">'$i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
axis([1 inf 0 inf])
xticks(1:1:length(s_v_d))

cap_y_hat;
RSMP = recover_SYSMP(cap_y_hat,n_mp,r,m);
SMP6 = zeros(2,n_mp);
SMP6(:,1) = D_d;
<span class="keyword">for</span> i=1:n_mp-1
    SMP6(:,i+1) = C_d*(A_d)^(i-1)*B_d;
<span class="keyword">end</span>


OMP6 = zeros(2,3*n+1);
OMP6(:,1) = D_d;

<span class="keyword">for</span> i=1:n

    OMP6(:,3*i-1:3*i+1) = C_d*(A_d+G2*C_d)^(i-1)*[B_d+G2*D_d -G2];
<span class="keyword">end</span>


figure
plot(vecnorm(SMP6-RSMP));
title(<span class="string">'Recovered System Markov Parameter Error'</span>)
ylabel(<span class="string">'$Y_i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
xlabel(<span class="string">'$i$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,20)
set(get(gca, <span class="string">'YLabel'</span>), <span class="string">'Rotation'</span>, 0,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>)
axis([1 inf 0 inf])
xticks(1:5:length(SMP))
</pre><img vspace="5" hspace="5" src="HW6_1_09.png" alt=""> <img vspace="5" hspace="5" src="HW6_1_10.png" alt=""> <p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2017b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% ENGS149 Homework 6
%% Problem 1
% Setup discrete system
close ALL HIDDEN
n = 2;
ll = 50;
A_c = [0 1; -1 0];
B_c = [0;1];
C = [1 0];
D = 0;
dt=0.2;
[r,n] = size(C);
[r,m] = size(D);
mat_ss = ss(A_c,B_c,C,D);
sys_dsct = c2d(mat_ss,dt);
A_d = sys_dsct.A;
B_d = sys_dsct.B;
C_d = sys_dsct.C;
D_d = sys_dsct.D;

%% Part 2

inp = randn(1,ll);
x_0 = [1 0];

[Y,X] = dlsim(A_d,B_d,C_d,D_d,inp,x_0);

%% 
% Using the acker function, we place the eigenvalues of A+GC at 0
G = acker(A_d',-C_d',[0 0])';

%%
% Here, I check G is working as expected by taking the norm of (A+GC)^2
norm((A_d+G*C)^2)


%% Part 3
% Generate Markov Parameters, System and Observer
n = 2;
N = 4;
OMP = zeros(1,2*n+1);

%%
% From class, we define the observer Markov Parameters using the following
% equations.
%
% $\bar{Y}_0 = D$
%
% $$\bar{Y}_i = C\bar{A}^{i-1}\bar{B}, i = 1...\infty$$
% 
% Where
%
% $$\bar{A} = A+GC$$
% 
% $$\bar{B} = [B+GD, -G]$$
OMP(1) = D;
for i=1:n
    
    OMP(2*i:2*i+1) = C_d*(A_d+G*C_d)^(i-1)*[B_d+G*D_d -G];
end

%%
% We compare this to the observer markov parameters calculated via the
% solution to the observer equation:
% 
% $\bar{y}=\bar{P}\bar{V}$
% 
% or equivalently,
%
% $$\bar{P}=\bar{y}\bar{V}^{\dagger}$$   

[Y_bar, V_bar] = YV_Form_nonzero(inp,Y',n);

%% 
% The pinv2 function (attached) calculates the pseudoinverse using the SVD
% with a tolerance on the percentage of each individual singular value to
% the largest singular value
cap_y_hat = Y_bar'*pinv2(V_bar,1e-5);

%%
% The Normalized Singular Values of $\bar{V}$ for p=2
figure
s_v_d  = svd(V_bar)';
s_v_d = s_v_d/max(s_v_d);
plot(s_v_d,'-x')


title('Normalized Singular Values of V_{bar}')
ylabel('$\frac{\sigma_i}{\sigma_r}$','Interpreter','latex','FontSize',30)
set(get(gca, 'YLabel'), 'Rotation', 0,'HorizontalAlignment','right')
xlabel('$i$','Interpreter','latex','FontSize',20)
axis([1 inf 0 inf])
xticks(1:1:length(s_v_d))
figure
plot(abs(OMP-cap_y_hat))
title('Recovered Observer Markov Parameter Error')
ylabel('$\bar{Y}_i$','Interpreter','latex','FontSize',20)
xlabel('$i$','Interpreter','latex','FontSize',20)
set(get(gca, 'YLabel'), 'Rotation', 0,'HorizontalAlignment','right')
axis([1 inf 0 inf])
xticks(1:1:length(OMP))

%% Part 4
% Generate System Markov Parameters 

n_mp = 5;

%%
% The system Markov Parameters are generated through the following
% equation:
%
% $$Y_0 = D$$
%
% $$Y_i = CA^{i-1}B, i = 1\dots\infty$$
% 
% The first five Markov Parameters are
SMP = zeros(1,n+1);
SMP(1) = D;
for i=1:n_mp-1
    SMP(i+1) = C_d*A_d^(i-1)*B_d;
end
SMP
%%
% We can recover the System Markov Parameters using the function
% recover_SYSMP.
%
% The function uses the following formula:
%
% $$Y_k = \bar{Y}^{(1)}_k - \sum_{i=1}^{k}\bar{Y}_i^{(2)}Y_{k-i}\quad k=1\dots p$$
%
% $$Y_k = - \sum_{i=1}^{k}\bar{Y}_i^{(2)}Y_{k-i}\quad k=p+1\dots \infty$$
RSMP = recover_SYSMP(cap_y_hat,n_mp,r,m);
SMP;

figure

plot(abs(SMP-RSMP));


axis([1 inf 0 inf])
xticks(1:1:length(SMP))
title('Recovered System Markov Parameter Error')
ylabel('$Y_i$','Interpreter','latex','FontSize',20)
xlabel('$i$','Interpreter','latex','FontSize',20)
set(get(gca, 'YLabel'), 'Rotation', 0,'HorizontalAlignment','right')


%% Part 5
% We repeat parts 3 and 4 above with p=6

n = 6;
N = 4;
OMP = zeros(1,2*n+1);

OMP(1) = D;
for i=1:n
    
    OMP(2*i:2*i+1) = C_d*(A_d+G*C_d)^(i-1)*[B_d+G*D_d -G];
end


[Y_bar, V_bar] = YV_Form_nonzero(inp,Y',n);
cap_y_hat = Y_bar'*pinv2(V_bar,1e-5);



figure
s_v_d  = svd(V_bar)';
s_v_d = s_v_d/max(s_v_d);
plot(s_v_d,'-x')
title('Normalized Singular Values of V_{bar}')
ylabel('$\frac{\sigma_i}{\sigma_r}$','Interpreter','latex','FontSize',30)
set(get(gca, 'YLabel'), 'Rotation', 0,'HorizontalAlignment','right')
xlabel('$i$','Interpreter','latex','FontSize',20)
axis([1 inf 0 inf])
xticks(1:1:length(s_v_d))



% Generate System Markov Parameters 

n_mp = 50;

SMP = zeros(1,n+1);
SMP(1) = D;
for i=1:n_mp-1
    SMP(i+1) = C_d*A_d^(i-1)*B_d;
end
RSMP = recover_SYSMP(cap_y_hat,n_mp,r,m);
SMP;

figure

plot(abs(SMP-RSMP));
title('Recovered System Markov Parameter Error')
ylabel('$Y_i$','Interpreter','latex','FontSize',20)
xlabel('$i$','Interpreter','latex','FontSize',20)
set(get(gca, 'YLabel'), 'Rotation', 0,'HorizontalAlignment','right')
axis([1 inf 0 inf])
xticks(1:5:length(SMP))


%% Part 6
% Repeat 3 and 4, but measure velocity and position

n = 1;
n_mp = 50;
ll = 50;
A_c = [0 1; -1 0];
B_c = [0;1];
C = [0 1;1 0];
D = [0;0];
dt=0.2;
[r_outputs,n_states] = size(C);
[r_outputs,m_inputs] = size(D);
mat_ss = ss(A_c,B_c,C,D);
sys_dsct = c2d(mat_ss,dt);
A_d = sys_dsct.A;
B_d = sys_dsct.B;
C_d = sys_dsct.C;
D_d = sys_dsct.D;

G2 = place(A_d',-C_d',[0 0]);

inp = randn(1,ll);
x_0 = [1 0.5];
[Y, X] = dlsim(A_d,B_d,C_d,D_d,inp,x_0);


[Y_bar, V_bar] = YV_Form_nonzero(inp,Y',n);


cap_y_hat = Y_bar'*pinv2(V_bar,1e-8);
figure
s_v_d  = svd(V_bar)';
s_v_d = s_v_d/max(s_v_d);
plot(s_v_d,'-x')
title('Normalized Singular Values of V_{bar}')
ylabel('$\frac{\sigma_i}{\sigma_r}$','Interpreter','latex','FontSize',30)
set(get(gca, 'YLabel'), 'Rotation', 0,'HorizontalAlignment','right')
xlabel('$i$','Interpreter','latex','FontSize',20)
axis([1 inf 0 inf])
xticks(1:1:length(s_v_d))



RSMP = recover_SYSMP(cap_y_hat,n_mp,r_outputs,m_inputs);
SMP6 = zeros(2,n_mp);
SMP6(:,1) = D_d;
for i=1:n_mp-1
    SMP6(:,i+1) = C_d*(A_d)^(i-1)*B_d;
end


OMP6 = zeros(2,3*n+1);
OMP6(:,1) = D_d;

for i=1:n
    
    OMP6(:,3*i-1:3*i+1) = C_d*(A_d+G2*C_d)^(i-1)*[B_d+G2*D_d -G2];
end

figure
plot(vecnorm(OMP6-cap_y_hat));
title('Recovered Observer Markov Parameter Error')
ylabel('$\bar{Y}_i$','Interpreter','latex','FontSize',20)
xlabel('$i$','Interpreter','latex','FontSize',20)
set(get(gca, 'YLabel'), 'Rotation', 0,'HorizontalAlignment','right')
axis([1 inf 0 inf])
xticks(1:1:length(OMP6))

figure
plot(vecnorm(abs(SMP6-RSMP)));
title('Recovered System Markov Parameter Error')
ylabel('$Y_i$','Interpreter','latex','FontSize',20)
xlabel('$i$','Interpreter','latex','FontSize',20)
set(get(gca, 'YLabel'), 'Rotation', 0,'HorizontalAlignment','right')
axis([1 inf 0 inf])
xticks(1:5:length(SMP))


%% Part 7
% Repeat for p=4

n = 6;
ll = 50;
A_c = [0 1; -1 0];
B_c = [0;1];
C = [1 0;0 1];
D = [0;0];
dt=0.2;
[r,n] = size(C);
[r,m] = size(D);

mat_ss = ss(A_c,B_c,C,D);
sys_dsct = c2d(mat_ss,dt);
A_d = sys_dsct.A;
B_d = sys_dsct.B;
C_d = sys_dsct.C;
D_d = sys_dsct.D;

G2 = place(A_d',-C_d',[0 0]);

inp = randn(1,ll);
x_0 = [1 0];
[Y, X] = dlsim(A_d,B_d,C_d,D_d,inp,x_0);


[Y_bar, V_bar] = YV_Form_nonzero(inp,Y',n);

LM = 15;
cap_y_hat = Y_bar'*pinv2(V_bar,1e-5);
figure
s_v_d  = svd(V_bar)';
s_v_d = s_v_d/max(s_v_d);
plot(s_v_d,'-x')
title('Normalized Singular Values of V_{bar}')
ylabel('$\frac{\sigma_i}{\sigma_r}$','Interpreter','latex','FontSize',30)
set(get(gca, 'YLabel'), 'Rotation', 0,'HorizontalAlignment','right')
xlabel('$i$','Interpreter','latex','FontSize',20)
axis([1 inf 0 inf])
xticks(1:1:length(s_v_d))

cap_y_hat;
RSMP = recover_SYSMP(cap_y_hat,n_mp,r,m);
SMP6 = zeros(2,n_mp);
SMP6(:,1) = D_d;
for i=1:n_mp-1
    SMP6(:,i+1) = C_d*(A_d)^(i-1)*B_d;
end


OMP6 = zeros(2,3*n+1);
OMP6(:,1) = D_d;

for i=1:n
    
    OMP6(:,3*i-1:3*i+1) = C_d*(A_d+G2*C_d)^(i-1)*[B_d+G2*D_d -G2];
end


figure
plot(vecnorm(SMP6-RSMP));
title('Recovered System Markov Parameter Error')
ylabel('$Y_i$','Interpreter','latex','FontSize',20)
xlabel('$i$','Interpreter','latex','FontSize',20)
set(get(gca, 'YLabel'), 'Rotation', 0,'HorizontalAlignment','right')
axis([1 inf 0 inf])
xticks(1:5:length(SMP))

##### SOURCE END #####
--></body></html>